{"version":3,"sources":["common/connect.test.tsx"],"names":[],"mappings":"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","file":"common/connect.test.js","sourcesContent":["/* tslint:disable:no-unused-variable */\nimport * as React from 'react';\n/* tslint:enable:no-unused-variable */\nimport * as ReactDOM from 'react-dom';\n\nimport * as ReactTestUtils from 'react-addons-test-utils';\nimport { connect } from './connect';\nimport { BaseStore } from './BaseStore';\nimport { StoreHost } from './StoreHost';\nimport { StoreSet } from './StoreSet';\nimport { storeKey } from './storeKey';\nimport { ISubscribable } from './ISubscribable';\n\nlet { expect } = chai;\n\ninterface ITestComponentProps extends React.HTMLProps<HTMLDivElement> { }\n\n// Dumb component.\nconst TestComponent = (props: ITestComponentProps) => (\n  <div { ...props } />\n);\n\n// Dumb store.\ninterface IHelloStore extends ISubscribable {\n  message: string;\n\n  say(message: string): void;\n}\n\ninterface IAddStore extends ISubscribable {\n  result: number;\n\n  add(num1: number, num2: number): void;\n}\n\nclass AddStore extends BaseStore implements ISubscribable {\n\n}\n\nclass HelloStore extends BaseStore implements IHelloStore {\n  public message: string = '';\n\n  public say(message) {\n    this.message = message;\n    this.emitChange();\n  }\n}\n\ndescribe('connect', () => {\n  it('can observe store changes', (done) => {\n    let hello1 = storeKey<IHelloStore>('hello1');\n    let hello2 = storeKey<IHelloStore>('hello2');\n    let localStores = new StoreSet()\n      .add(hello1, new HelloStore())\n      .add(hello2, new HelloStore());\n\n    let Connected = connect<ITestComponentProps, {}>(\n      TestComponent,\n      [hello1, hello2],\n      (props: ITestComponentProps, hello1Store: IHelloStore, hello2Store: IHelloStore) => ({\n        children: hello1Store.message + hello2Store.message\n      })\n    );\n    let root = ReactTestUtils.renderIntoDocument(\n      <div>\n        <StoreHost stores={ localStores }>\n          <Connected />\n        </StoreHost>\n      </div>\n    );\n    let rootElement = ReactDOM.findDOMNode(root);\n\n    expect(rootElement.textContent).equals('');\n\n    localStores.getStore(hello1).say('hello');\n    setTimeout(() => {\n      try {\n        expect(rootElement.textContent).equals('hello');\n        localStores.getStore(hello2).say(' world');\n\n        setTimeout(() => {\n          try {\n            expect(rootElement.textContent).equals('hello world');\n            done();\n          } catch (e) { done(e); }\n        }, 10);\n\n      } catch (e) { done(e); }\n    }, 10);\n\n  });\n\n  it('can throw when requiring a store in an environment without any stores hosted', () => {\n    let hello = storeKey<IHelloStore>('hello');\n    let Connected = connect(\n      TestComponent,\n      [hello],\n      () => { /* empty */ }\n    );\n    let threwException = false;\n\n    try {\n      ReactTestUtils.renderIntoDocument(\n        <div>\n          <Connected />\n        </div>\n      );\n    } catch (e) { threwException = true; }\n\n    expect(threwException).to.be.true;\n  });\n\n  it('can throw in an environment that does not contain the required store', () => {\n    let hello = storeKey<IHelloStore>('hello');\n    let Connected = connect(\n      TestComponent,\n      [hello],\n      () => { /* empty */ }\n    );\n    let threwException = false;\n\n    try {\n      ReactTestUtils.renderIntoDocument(\n        <StoreHost stores={ new StoreSet() }>\n          <div>\n            <Connected />\n          </div>\n        </StoreHost>\n      );\n    } catch (e) { threwException = true; }\n\n    expect(threwException).to.be.true;\n  });\n\n  it('renders a connected component 1 time when multiple stores fire changes', (done) => {\n    let resolves = 0;\n    let renders = 0;\n\n    const Dumb = () => {\n      renders++;\n      return <div>hi</div>;\n    };\n\n    let hello1 = storeKey<IHelloStore>('hello1');\n    let hello2 = storeKey<IHelloStore>('hello2');\n    let localStores = new StoreSet()\n      .add(hello1, new HelloStore())\n      .add(hello2, new HelloStore());\n    let Connected = connect(\n      Dumb,\n      [hello1, hello2],\n      () => {\n        resolves++;\n        return {};\n      });\n\n    ReactTestUtils.renderIntoDocument(\n      <div>\n        <StoreHost stores={ localStores }>\n          <Connected />\n        </StoreHost>\n      </div>\n    );\n\n    expect(resolves).to.equal(1, 'resolve was not 1');\n    expect(renders).to.equal(1, 'render was not 1');\n\n    // Cause 2 store changes. This should setImmediate and cause 1 resolve.\n    localStores.getStore(hello1).say('hello');\n    localStores.getStore(hello2).say(' world');\n\n    setTimeout(() => {\n      try {\n        expect(resolves).to.equal(2, 'resolve was not 2');\n        expect(renders).to.equal(1, 'render was not 1');\n        done();\n      } catch (e) { done(e); }\n    }, 10);\n  });\n});\n"],"sourceRoot":"/src"}