373c8d22b6ae1f83e2ac63b6c5f01634
"use strict";
// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.

Object.defineProperty(exports, "__esModule", { value: true });
const ITerminalProvider_1 = require("./ITerminalProvider");
const Colors_1 = require("./Colors");
/**
 * This class facilitates writing to a console.
 *
 * @beta
 */
class Terminal {
    constructor(provider) {
        this._providers = new Set();
        this._providers.add(provider);
    }
    /**
     * Subscribe a new terminal provider.
     */
    registerProvider(provider) {
        this._providers.add(provider);
    }
    /**
     * Unsubscribe a terminal provider. If the provider isn't subscribed, this function does nothing.
     */
    unregisterProvider(provider) {
        if (this._providers.has(provider)) {
            this._providers.delete(provider);
        }
    }
    /**
     * Write a generic message to the terminal
     */
    write(...messageParts) {
        this._writeSegmentsToProviders(messageParts, ITerminalProvider_1.TerminalProviderSeverity.log);
    }
    /**
     * Write a generic message to the terminal, followed by a newline
     */
    writeLine(...messageParts) {
        this.write(...messageParts, Colors_1.eolSequence);
    }
    /**
     * Write a warning message to the console with yellow text.
     *
     * @remarks
     * The yellow color takes precedence over any other foreground colors set.
     */
    writeWarning(...messageParts) {
        this._writeSegmentsToProviders(messageParts.map(part => Object.assign({}, Colors_1.Colors._normalizeStringOrColorableSequence(part), { foregroundColor: Colors_1.ColorValue.Yellow })), ITerminalProvider_1.TerminalProviderSeverity.warning);
    }
    /**
     * Write a warning message to the console with yellow text, followed by a newline.
     *
     * @remarks
     * The yellow color takes precedence over any other foreground colors set.
     */
    writeWarningLine(...messageParts) {
        this._writeSegmentsToProviders([...messageParts.map(part => Object.assign({}, Colors_1.Colors._normalizeStringOrColorableSequence(part), { foregroundColor: Colors_1.ColorValue.Yellow })), Colors_1.eolSequence], ITerminalProvider_1.TerminalProviderSeverity.warning);
    }
    /**
     * Write an error message to the console with red text.
     *
     * @remarks
     * The red color takes precedence over any other foreground colors set.
     */
    writeError(...messageParts) {
        this._writeSegmentsToProviders(messageParts.map(part => Object.assign({}, Colors_1.Colors._normalizeStringOrColorableSequence(part), { foregroundColor: Colors_1.ColorValue.Red })), ITerminalProvider_1.TerminalProviderSeverity.error);
    }
    /**
     * Write an error message to the console with red text, followed by a newline.
     *
     * @remarks
     * The red color takes precedence over any other foreground colors set.
     */
    writeErrorLine(...messageParts) {
        this._writeSegmentsToProviders([...messageParts.map(part => Object.assign({}, Colors_1.Colors._normalizeStringOrColorableSequence(part), { foregroundColor: Colors_1.ColorValue.Red })), Colors_1.eolSequence], ITerminalProvider_1.TerminalProviderSeverity.error);
    }
    /**
     * Write a verbose-level message.
     */
    writeVerbose(...messageParts) {
        this._writeSegmentsToProviders(messageParts, ITerminalProvider_1.TerminalProviderSeverity.verbose);
    }
    /**
     * Write a verbose-level message followed by a newline.
     */
    writeVerboseLine(...messageParts) {
        this.writeVerbose(...messageParts, Colors_1.eolSequence);
    }
    _writeSegmentsToProviders(segments, severity) {
        const withColorText = {};
        const withoutColorText = {};
        let withColorLines;
        let withoutColorLines;
        this._providers.forEach(provider => {
            const eol = provider.eolCharacter;
            let textToWrite;
            if (provider.supportsColor) {
                if (!withColorLines) {
                    withColorLines = this._serializeFormattableTextSegments(segments, true);
                }
                if (!withColorText[eol]) {
                    withColorText[eol] = withColorLines.join(eol);
                }
                textToWrite = withColorText[eol];
            } else {
                if (!withoutColorLines) {
                    withoutColorLines = this._serializeFormattableTextSegments(segments, false);
                }
                if (!withoutColorText[eol]) {
                    withoutColorText[eol] = withoutColorLines.join(eol);
                }
                textToWrite = withoutColorText[eol];
            }
            provider.write(textToWrite, severity);
        });
    }
    _serializeFormattableTextSegments(segments, withColor) {
        const lines = [];
        let segmentsToJoin = [];
        let lastSegmentWasEol = false;
        for (let i = 0; i < segments.length; i++) {
            const segment = Colors_1.Colors._normalizeStringOrColorableSequence(segments[i]);
            lastSegmentWasEol = !!segment.isEol;
            if (lastSegmentWasEol) {
                lines.push(segmentsToJoin.join(''));
                segmentsToJoin = [];
            } else {
                if (withColor) {
                    const startColorCodes = [];
                    const endColorCodes = [];
                    switch (segment.foregroundColor) {
                        case Colors_1.ColorValue.Black:
                            {
                                startColorCodes.push(30);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Red:
                            {
                                startColorCodes.push(31);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Green:
                            {
                                startColorCodes.push(32);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Yellow:
                            {
                                startColorCodes.push(33);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Blue:
                            {
                                startColorCodes.push(34);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Magenta:
                            {
                                startColorCodes.push(35);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Cyan:
                            {
                                startColorCodes.push(36);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.White:
                            {
                                startColorCodes.push(37);
                                endColorCodes.push(39);
                                break;
                            }
                        case Colors_1.ColorValue.Gray:
                            {
                                startColorCodes.push(90);
                                endColorCodes.push(39);
                                break;
                            }
                    }
                    switch (segment.backgroundColor) {
                        case Colors_1.ColorValue.Black:
                            {
                                startColorCodes.push(40);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Red:
                            {
                                startColorCodes.push(41);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Green:
                            {
                                startColorCodes.push(42);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Yellow:
                            {
                                startColorCodes.push(43);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Blue:
                            {
                                startColorCodes.push(44);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Magenta:
                            {
                                startColorCodes.push(45);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Cyan:
                            {
                                startColorCodes.push(46);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.White:
                            {
                                startColorCodes.push(47);
                                endColorCodes.push(49);
                                break;
                            }
                        case Colors_1.ColorValue.Gray:
                            {
                                startColorCodes.push(100);
                                endColorCodes.push(49);
                                break;
                            }
                    }
                    if (segment.textAttributes) {
                        for (const textAttribute of segment.textAttributes) {
                            switch (textAttribute) {
                                case Colors_1.TextAttribute.Bold:
                                    {
                                        startColorCodes.push(1);
                                        endColorCodes.push(21);
                                        break;
                                    }
                                case Colors_1.TextAttribute.Dim:
                                    {
                                        startColorCodes.push(2);
                                        endColorCodes.push(22);
                                        break;
                                    }
                                case Colors_1.TextAttribute.Underline:
                                    {
                                        startColorCodes.push(4);
                                        endColorCodes.push(24);
                                        break;
                                    }
                                case Colors_1.TextAttribute.Blink:
                                    {
                                        startColorCodes.push(5);
                                        endColorCodes.push(25);
                                        break;
                                    }
                                case Colors_1.TextAttribute.InvertColor:
                                    {
                                        startColorCodes.push(7);
                                        endColorCodes.push(27);
                                        break;
                                    }
                                case Colors_1.TextAttribute.Hidden:
                                    {
                                        startColorCodes.push(8);
                                        endColorCodes.push(28);
                                        break;
                                    }
                            }
                        }
                    }
                    for (let j = 0; j < startColorCodes.length; j++) {
                        const code = startColorCodes[j];
                        segmentsToJoin.push(...['\u001b[', code.toString(), 'm']);
                    }
                    segmentsToJoin.push(segment.text);
                    for (let j = endColorCodes.length - 1; j >= 0; j--) {
                        const code = endColorCodes[j];
                        segmentsToJoin.push(...['\u001b[', code.toString(), 'm']);
                    }
                } else {
                    segmentsToJoin.push(segment.text);
                }
            }
        }
        if (segmentsToJoin.length > 0) {
            lines.push(segmentsToJoin.join(''));
        }
        if (lastSegmentWasEol) {
            lines.push('');
        }
        return lines;
    }
}
exports.Terminal = Terminal;
//# sourceMappingURL=Terminal.js.map
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRlcm1pbmFsLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiSVRlcm1pbmFsUHJvdmlkZXJfMSIsInJlcXVpcmUiLCJDb2xvcnNfMSIsIlRlcm1pbmFsIiwiY29uc3RydWN0b3IiLCJwcm92aWRlciIsIl9wcm92aWRlcnMiLCJTZXQiLCJhZGQiLCJyZWdpc3RlclByb3ZpZGVyIiwidW5yZWdpc3RlclByb3ZpZGVyIiwiaGFzIiwiZGVsZXRlIiwid3JpdGUiLCJtZXNzYWdlUGFydHMiLCJfd3JpdGVTZWdtZW50c1RvUHJvdmlkZXJzIiwiVGVybWluYWxQcm92aWRlclNldmVyaXR5IiwibG9nIiwid3JpdGVMaW5lIiwiZW9sU2VxdWVuY2UiLCJ3cml0ZVdhcm5pbmciLCJtYXAiLCJwYXJ0IiwiYXNzaWduIiwiQ29sb3JzIiwiX25vcm1hbGl6ZVN0cmluZ09yQ29sb3JhYmxlU2VxdWVuY2UiLCJmb3JlZ3JvdW5kQ29sb3IiLCJDb2xvclZhbHVlIiwiWWVsbG93Iiwid2FybmluZyIsIndyaXRlV2FybmluZ0xpbmUiLCJ3cml0ZUVycm9yIiwiUmVkIiwiZXJyb3IiLCJ3cml0ZUVycm9yTGluZSIsIndyaXRlVmVyYm9zZSIsInZlcmJvc2UiLCJ3cml0ZVZlcmJvc2VMaW5lIiwic2VnbWVudHMiLCJzZXZlcml0eSIsIndpdGhDb2xvclRleHQiLCJ3aXRob3V0Q29sb3JUZXh0Iiwid2l0aENvbG9yTGluZXMiLCJ3aXRob3V0Q29sb3JMaW5lcyIsImZvckVhY2giLCJlb2wiLCJlb2xDaGFyYWN0ZXIiLCJ0ZXh0VG9Xcml0ZSIsInN1cHBvcnRzQ29sb3IiLCJfc2VyaWFsaXplRm9ybWF0dGFibGVUZXh0U2VnbWVudHMiLCJqb2luIiwid2l0aENvbG9yIiwibGluZXMiLCJzZWdtZW50c1RvSm9pbiIsImxhc3RTZWdtZW50V2FzRW9sIiwiaSIsImxlbmd0aCIsInNlZ21lbnQiLCJpc0VvbCIsInB1c2giLCJzdGFydENvbG9yQ29kZXMiLCJlbmRDb2xvckNvZGVzIiwiQmxhY2siLCJHcmVlbiIsIkJsdWUiLCJNYWdlbnRhIiwiQ3lhbiIsIldoaXRlIiwiR3JheSIsImJhY2tncm91bmRDb2xvciIsInRleHRBdHRyaWJ1dGVzIiwidGV4dEF0dHJpYnV0ZSIsIlRleHRBdHRyaWJ1dGUiLCJCb2xkIiwiRGltIiwiVW5kZXJsaW5lIiwiQmxpbmsiLCJJbnZlcnRDb2xvciIsIkhpZGRlbiIsImoiLCJjb2RlIiwidG9TdHJpbmciLCJ0ZXh0Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0FBLE9BQU9DLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDLEVBQUVDLE9BQU8sSUFBVCxFQUE3QztBQUNBLE1BQU1DLHNCQUFzQkMsUUFBUSxxQkFBUixDQUE1QjtBQUNBLE1BQU1DLFdBQVdELFFBQVEsVUFBUixDQUFqQjtBQUNBOzs7OztBQUtBLE1BQU1FLFFBQU4sQ0FBZTtBQUNYQyxnQkFBWUMsUUFBWixFQUFzQjtBQUNsQixhQUFLQyxVQUFMLEdBQWtCLElBQUlDLEdBQUosRUFBbEI7QUFDQSxhQUFLRCxVQUFMLENBQWdCRSxHQUFoQixDQUFvQkgsUUFBcEI7QUFDSDtBQUNEOzs7QUFHQUkscUJBQWlCSixRQUFqQixFQUEyQjtBQUN2QixhQUFLQyxVQUFMLENBQWdCRSxHQUFoQixDQUFvQkgsUUFBcEI7QUFDSDtBQUNEOzs7QUFHQUssdUJBQW1CTCxRQUFuQixFQUE2QjtBQUN6QixZQUFJLEtBQUtDLFVBQUwsQ0FBZ0JLLEdBQWhCLENBQW9CTixRQUFwQixDQUFKLEVBQW1DO0FBQy9CLGlCQUFLQyxVQUFMLENBQWdCTSxNQUFoQixDQUF1QlAsUUFBdkI7QUFDSDtBQUNKO0FBQ0Q7OztBQUdBUSxVQUFNLEdBQUdDLFlBQVQsRUFBdUI7QUFDbkIsYUFBS0MseUJBQUwsQ0FBK0JELFlBQS9CLEVBQTZDZCxvQkFBb0JnQix3QkFBcEIsQ0FBNkNDLEdBQTFGO0FBQ0g7QUFDRDs7O0FBR0FDLGNBQVUsR0FB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QjtBQUMzQkosa0JBQU1PLElBQU4sQ0FBV04sZUFBZUgsSUFBZixDQUFvQixFQUFwQixDQUFYO0FBQ0g7QUFDRCxZQUFJSSxpQkFBSixFQUF1QjtBQUNuQkYsa0JBQU1PLElBQU4sQ0FBVyxFQUFYO0FBQ0g7QUFDRCxlQUFPUCxLQUFQO0FBQ0g7QUFqU1U7QUFtU2Z0RCxRQUFRSyxRQUFSLEdBQW1CQSxRQUFuQjtBQUNBIiwiZmlsZSI6IlRlcm1pbmFsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuLy8gU2VlIExJQ0VOU0UgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IElUZXJtaW5hbFByb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9JVGVybWluYWxQcm92aWRlclwiKTtcbmNvbnN0IENvbG9yc18xID0gcmVxdWlyZShcIi4vQ29sb3JzXCIpO1xuLyoqXG4gKiBUaGlzIGNsYXNzIGZhY2lsaXRhdGVzIHdyaXRpbmcgdG8gYSBjb25zb2xlLlxuICpcbiAqIEBiZXRhXG4gKi9cbmNsYXNzIFRlcm1pbmFsIHtcbiAgICBjb25zdHJ1Y3Rvcihwcm92aWRlcikge1xuICAgICAgICB0aGlzLl9wcm92aWRlcnMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuX3Byb3ZpZGVycy5hZGQocHJvdmlkZXIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmUgYSBuZXcgdGVybWluYWwgcHJvdmlkZXIuXG4gICAgICovXG4gICAgcmVnaXN0ZXJQcm92aWRlcihwcm92aWRlcikge1xuICAgICAgICB0aGlzLl9wcm92aWRlcnMuYWRkKHByb3ZpZGVyKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVW5zdWJzY3JpYmUgYSB0ZXJtaW5hbCBwcm92aWRlci4gSWYgdGhlIHByb3ZpZGVyIGlzbid0IHN1YnNjcmliZWQsIHRoaXMgZnVuY3Rpb24gZG9lcyBub3RoaW5nLlxuICAgICAqL1xuICAgIHVucmVnaXN0ZXJQcm92aWRlcihwcm92aWRlcikge1xuICAgICAgICBpZiAodGhpcy5fcHJvdmlkZXJzLmhhcyhwcm92aWRlcikpIHtcbiAgICAgICAgICAgIHRoaXMuX3Byb3ZpZGVycy5kZWxldGUocHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlIGEgZ2VuZXJpYyBtZXNzYWdlIHRvIHRoZSB0ZXJtaW5hbFxuICAgICAqL1xuICAgIHdyaXRlKC4uLm1lc3NhZ2VQYXJ0cykge1xuICAgICAgICB0aGlzLl93cml0ZVNlZ21lbnRzVG9Qcm92aWRlcnMobWVzc2FnZVBhcnRzLCBJVGVybWluYWxQcm92aWRlcl8xLlRlcm1pbmFsUHJvdmlkZXJTZXZlcml0eS5sb2cpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZSBhIGdlbmVyaWMgbWVzc2FnZSB0byB0aGUgdGVybWluYWwsIGZvbGxvd2VkIGJ5IGEgbmV3bGluZVxuICAgICAqL1xuICAgIHdyaXRlTGluZSguLi5tZXNzYWdlUGFydHMpIHtcbiAgICAgICAgdGhpcy53cml0ZSguLi5tZXNzYWdlUGFydHMsIENvbG9yc18xLmVvbFNlcXVlbmNlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV3JpdGUgYSB3YXJuaW5nIG1lc3NhZ2UgdG8gdGhlIGNvbnNvbGUgd2l0aCB5ZWxsb3cgdGV4dC5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhlIHllbGxvdyBjb2xvciB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYW55IG90aGVyIGZvcmVncm91bmQgY29sb3JzIHNldC5cbiAgICAgKi9cbiAgICB3cml0ZVdhcm5pbmcoLi4ubWVzc2FnZVBhcnRzKSB7XG4gICAgICAgIHRoaXMuX3dyaXRlU2VnbWVudHNUb1Byb3ZpZGVycyhtZXNzYWdlUGFydHMubWFwKChwYXJ0KSA9PiAoT2JqZWN0LmFzc2lnbih7fSwgQ29sb3JzXzEuQ29sb3JzLl9ub3JtYWxpemVTdHJpbmdPckNvbG9yYWJsZVNlcXVlbmNlKHBhcnQpLCB7IGZvcmVncm91bmRDb2xvcjogQ29sb3JzXzEuQ29sb3JWYWx1ZS5ZZWxsb3cgfSkpKSwgSVRlcm1pbmFsUHJvdmlkZXJfMS5UZXJtaW5hbFByb3ZpZGVyU2V2ZXJpdHkud2FybmluZyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlIGEgd2FybmluZyBtZXNzYWdlIHRvIHRoZSBjb25zb2xlIHdpdGggeWVsbG93IHRleHQsIGZvbGxvd2VkIGJ5IGEgbmV3bGluZS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhlIHllbGxvdyBjb2xvciB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYW55IG90aGVyIGZvcmVncm91bmQgY29sb3JzIHNldC5cbiAgICAgKi9cbiAgICB3cml0ZVdhcm5pbmdMaW5lKC4uLm1lc3NhZ2VQYXJ0cykge1xuICAgICAgICB0aGlzLl93cml0ZVNlZ21lbnRzVG9Qcm92aWRlcnMoW1xuICAgICAgICAgICAgLi4ubWVzc2FnZVBhcnRzLm1hcCgocGFydCkgPT4gKE9iamVjdC5hc3NpZ24oe30sIENvbG9yc18xLkNvbG9ycy5fbm9ybWFsaXplU3RyaW5nT3JDb2xvcmFibGVTZXF1ZW5jZShwYXJ0KSwgeyBmb3JlZ3JvdW5kQ29sb3I6IENvbG9yc18xLkNvbG9yVmFsdWUuWWVsbG93IH0pKSksXG4gICAgICAgICAgICBDb2xvcnNfMS5lb2xTZXF1ZW5jZVxuICAgICAgICBdLCBJVGVybWluYWxQcm92aWRlcl8xLlRlcm1pbmFsUHJvdmlkZXJTZXZlcml0eS53YXJuaW5nKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV3JpdGUgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgY29uc29sZSB3aXRoIHJlZCB0ZXh0LlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGUgcmVkIGNvbG9yIHRha2VzIHByZWNlZGVuY2Ugb3ZlciBhbnkgb3RoZXIgZm9yZWdyb3VuZCBjb2xvcnMgc2V0LlxuICAgICAqL1xuICAgIHdyaXRlRXJyb3IoLi4ubWVzc2FnZVBhcnRzKSB7XG4gICAgICAgIHRoaXMuX3dyaXRlU2VnbWVudHNUb1Byb3ZpZGVycyhtZXNzYWdlUGFydHMubWFwKChwYXJ0KSA9PiAoT2JqZWN0LmFzc2lnbih7fSwgQ29sb3JzXzEuQ29sb3JzLl9ub3JtYWxpemVTdHJpbmdPckNvbG9yYWJsZVNlcXVlbmNlKHBhcnQpLCB7IGZvcmVncm91bmRDb2xvcjogQ29sb3JzXzEuQ29sb3JWYWx1ZS5SZWQgfSkpKSwgSVRlcm1pbmFsUHJvdmlkZXJfMS5UZXJtaW5hbFByb3ZpZGVyU2V2ZXJpdHkuZXJyb3IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZSBhbiBlcnJvciBtZXNzYWdlIHRvIHRoZSBjb25zb2xlIHdpdGggcmVkIHRleHQsIGZvbGxvd2VkIGJ5IGEgbmV3bGluZS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogVGhlIHJlZCBjb2xvciB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYW55IG90aGVyIGZvcmVncm91bmQgY29sb3JzIHNldC5cbiAgICAgKi9cbiAgICB3cml0ZUVycm9yTGluZSguLi5tZXNzYWdlUGFydHMpIHtcbiAgICAgICAgdGhpcy5fd3JpdGVTZWdtZW50c1RvUHJvdmlkZXJzKFtcbiAgICAgICAgICAgIC4uLm1lc3NhZ2VQYXJ0cy5tYXAoKHBhcnQpID0+IChPYmplY3QuYXNzaWduKHt9LCBDb2xvcnNfMS5Db2xvcnMuX25vcm1hbGl6ZVN0cmluZ09yQ29sb3JhYmxlU2VxdWVuY2UocGFydCksIHsgZm9yZWdyb3VuZENvbG9yOiBDb2xvcnNfMS5Db2xvclZhbHVlLlJlZCB9KSkpLFxuICAgICAgICAgICAgQ29sb3JzXzEuZW9sU2VxdWVuY2VcbiAgICAgICAgXSwgSVRlcm1pbmFsUHJvdmlkZXJfMS5UZXJtaW5hbFByb3ZpZGVyU2V2ZXJpdHkuZXJyb3IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZSBhIHZlcmJvc2UtbGV2ZWwgbWVzc2FnZS5cbiAgICAgKi9cbiAgICB3cml0ZVZlcmJvc2UoLi4ubWVzc2FnZVBhcnRzKSB7XG4gICAgICAgIHRoaXMuX3dyaXRlU2VnbWVudHNUb1Byb3ZpZGVycyhtZXNzYWdlUGFydHMsIElUZXJtaW5hbFByb3ZpZGVyXzEuVGVybWluYWxQcm92aWRlclNldmVyaXR5LnZlcmJvc2UpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZSBhIHZlcmJvc2UtbGV2ZWwgbWVzc2FnZSBmb2xsb3dlZCBieSBhIG5ld2xpbmUuXG4gICAgICovXG4gICAgd3JpdGVWZXJib3NlTGluZSguLi5tZXNzYWdlUGFydHMpIHtcbiAgICAgICAgdGhpcy53cml0ZVZlcmJvc2UoLi4ubWVzc2FnZVBhcnRzLCBDb2xvcnNfMS5lb2xTZXF1ZW5jZSk7XG4gICAgfVxuICAgIF93cml0ZVNlZ21lbnRzVG9Qcm92aWRlcnMoc2VnbWVudHMsIHNldmVyaXR5KSB7XG4gICAgICAgIGNvbnN0IHdpdGhDb2xvclRleHQgPSB7fTtcbiAgICAgICAgY29uc3Qgd2l0aG91dENvbG9yVGV4dCA9IHt9O1xuICAgICAgICBsZXQgd2l0aENvbG9yTGluZXM7XG4gICAgICAgIGxldCB3aXRob3V0Q29sb3JMaW5lcztcbiAgICAgICAgdGhpcy5fcHJvdmlkZXJzLmZvckVhY2goKHByb3ZpZGVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlb2wgPSBwcm92aWRlci5lb2xDaGFyYWN0ZXI7XG4gICAgICAgICAgICBsZXQgdGV4dFRvV3JpdGU7XG4gICAgICAgICAgICBpZiAocHJvdmlkZXIuc3VwcG9ydHNDb2xvcikge1xuICAgICAgICAgICAgICAgIGlmICghd2l0aENvbG9yTGluZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgd2l0aENvbG9yTGluZXMgPSB0aGlzLl9zZXJpYWxpemVGb3JtYXR0YWJsZVRleHRTZWdtZW50cyhzZWdtZW50cywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghd2l0aENvbG9yVGV4dFtlb2xdKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpdGhDb2xvclRleHRbZW9sXSA9IHdpdGhDb2xvckxpbmVzLmpvaW4oZW9sKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGV4dFRvV3JpdGUgPSB3aXRoQ29sb3JUZXh0W2VvbF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIXdpdGhvdXRDb2xvckxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpdGhvdXRDb2xvckxpbmVzID0gdGhpcy5fc2VyaWFsaXplRm9ybWF0dGFibGVUZXh0U2VnbWVudHMoc2VnbWVudHMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF3aXRob3V0Q29sb3JUZXh0W2VvbF0pIHtcbiAgICAgICAgICAgICAgICAgICAgd2l0aG91dENvbG9yVGV4dFtlb2xdID0gd2l0aG91dENvbG9yTGluZXMuam9pbihlb2wpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0ZXh0VG9Xcml0ZSA9IHdpdGhvdXRDb2xvclRleHRbZW9sXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb3ZpZGVyLndyaXRlKHRleHRUb1dyaXRlLCBzZXZlcml0eSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBfc2VyaWFsaXplRm9ybWF0dGFibGVUZXh0U2VnbWVudHMoc2VnbWVudHMsIHdpdGhDb2xvcikge1xuICAgICAgICBjb25zdCBsaW5lcyA9IFtdO1xuICAgICAgICBsZXQgc2VnbWVudHNUb0pvaW4gPSBbXTtcbiAgICAgICAgbGV0IGxhc3RTZWdtZW50V2FzRW9sID0gZmFsc2U7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VnbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHNlZ21lbnQgPSBDb2xvcnNfMS5Db2xvcnMuX25vcm1hbGl6ZVN0cmluZ09yQ29sb3JhYmxlU2VxdWVuY2Uoc2VnbWVudHNbaV0pO1xuICAgICAgICAgICAgbGFzdFNlZ21lbnRXYXNFb2wgPSAhIXNlZ21lbnQuaXNFb2w7XG4gICAgICAgICAgICBpZiAobGFzdFNlZ21lbnRXYXNFb2wpIHtcbiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKHNlZ21lbnRzVG9Kb2luLmpvaW4oJycpKTtcbiAgICAgICAgICAgICAgICBzZWdtZW50c1RvSm9pbiA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpdGhDb2xvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydENvbG9yQ29kZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kQ29sb3JDb2RlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHNlZ21lbnQuZm9yZWdyb3VuZENvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLkNvbG9yVmFsdWUuQmxhY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yQ29kZXMucHVzaCgzMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDM5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuQ29sb3JWYWx1ZS5SZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yQ29kZXMucHVzaCgzMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDM5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuQ29sb3JWYWx1ZS5HcmVlbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDMyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMzkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5Db2xvclZhbHVlLlllbGxvdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDMzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMzkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5Db2xvclZhbHVlLkJsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yQ29kZXMucHVzaCgzNCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDM5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuQ29sb3JWYWx1ZS5NYWdlbnRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goMzUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZENvbG9yQ29kZXMucHVzaCgzOSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLkNvbG9yVmFsdWUuQ3lhbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDM2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMzkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5Db2xvclZhbHVlLldoaXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goMzcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZENvbG9yQ29kZXMucHVzaCgzOSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLkNvbG9yVmFsdWUuR3JheToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDkwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMzkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc2VnbWVudC5iYWNrZ3JvdW5kQ29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuQ29sb3JWYWx1ZS5CbGFjazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDQwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goNDkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5Db2xvclZhbHVlLlJlZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDQxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goNDkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5Db2xvclZhbHVlLkdyZWVuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goNDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZENvbG9yQ29kZXMucHVzaCg0OSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLkNvbG9yVmFsdWUuWWVsbG93OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goNDMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZENvbG9yQ29kZXMucHVzaCg0OSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLkNvbG9yVmFsdWUuQmx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDQ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goNDkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5Db2xvclZhbHVlLk1hZ2VudGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yQ29kZXMucHVzaCg0NSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDQ5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuQ29sb3JWYWx1ZS5DeWFuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goNDYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZENvbG9yQ29kZXMucHVzaCg0OSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLkNvbG9yVmFsdWUuV2hpdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yQ29kZXMucHVzaCg0Nyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDQ5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuQ29sb3JWYWx1ZS5HcmF5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goNDkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWdtZW50LnRleHRBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRleHRBdHRyaWJ1dGUgb2Ygc2VnbWVudC50ZXh0QXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGV4dEF0dHJpYnV0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLlRleHRBdHRyaWJ1dGUuQm9sZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMjEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5UZXh0QXR0cmlidXRlLkRpbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMjIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5UZXh0QXR0cmlidXRlLlVuZGVybGluZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvckNvZGVzLnB1c2goNCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRDb2xvckNvZGVzLnB1c2goMjQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2xvcnNfMS5UZXh0QXR0cmlidXRlLkJsaW5rOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yQ29kZXMucHVzaCg1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZENvbG9yQ29kZXMucHVzaCgyNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENvbG9yc18xLlRleHRBdHRyaWJ1dGUuSW52ZXJ0Q29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDI3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JzXzEuVGV4dEF0dHJpYnV0ZS5IaWRkZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3JDb2Rlcy5wdXNoKDgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JDb2Rlcy5wdXNoKDI4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc3RhcnRDb2xvckNvZGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RlID0gc3RhcnRDb2xvckNvZGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudHNUb0pvaW4ucHVzaCguLi5bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1xcdTAwMWJbJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ20nXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50c1RvSm9pbi5wdXNoKHNlZ21lbnQudGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSBlbmRDb2xvckNvZGVzLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RlID0gZW5kQ29sb3JDb2Rlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzVG9Kb2luLnB1c2goLi4uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcXHUwMDFiWycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtJ1xuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzVG9Kb2luLnB1c2goc2VnbWVudC50ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlZ21lbnRzVG9Kb2luLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxpbmVzLnB1c2goc2VnbWVudHNUb0pvaW4uam9pbignJykpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYXN0U2VnbWVudFdhc0VvbCkge1xuICAgICAgICAgICAgbGluZXMucHVzaCgnJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmVzO1xuICAgIH1cbn1cbmV4cG9ydHMuVGVybWluYWwgPSBUZXJtaW5hbDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVRlcm1pbmFsLmpzLm1hcCJdfQ==